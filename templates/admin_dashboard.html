{% extends 'base.html' %}

{% block content %}
<style>
    /* Dashboard specific styles */
    .container { max-width: 900px; margin: 30px auto; background: white; padding: 30px; border: 1px solid #ddd; }
    
    /* Header */
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
    .header h1 { margin: 0; font-size: 24px; color: #333; }
    .logout-btn { background: #d9534f; color: white; text-decoration: none; padding: 8px 15px; border-radius: 4px; font-size: 14px; }
    
    /* Stats Cards */
    .stats-row { display: flex; gap: 20px; margin-bottom: 30px; }
    .stat-card { flex: 1; border: 1px solid #ccc; padding: 15px; background: #fdfdfd; text-align: center; border-radius: 4px; }
    .stat-card span { color: #666; font-size: 12px; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
    .stat-card h2 { margin: 10px 0 0; font-size: 28px; color: #333; }
    
    /* Section Boxes */
    .section-box { border: 1px solid #ddd; padding: 20px; margin-bottom: 30px; border-radius: 4px; background: #fff; }
    .section-box h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 18px; }
    
    /* Tables */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th { text-align: left; background-color: #f9f9f9; padding: 12px; border-bottom: 2px solid #ddd; font-size: 14px; font-weight: bold; color: #555; }
    td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; color: #333; }
    
    /* Alerts & Reports */
    .alert-text { color: #d9534f; font-weight: bold; }
    .report-text { font-family: 'Courier New', monospace; line-height: 1.6; background: #f9f9f9; padding: 15px; border: 1px solid #eee; color: #333; }
    
    /* Compliance Tag */
    .compliance-tag { color: white; padding: 5px 15px; font-weight: bold; border-radius: 4px; font-size: 14px; }
</style>

<div class="container">

    <div class="header">
        <h1>Admin Dashboard</h1>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <span>Total Users</span>
            <h2>{{ total_users }}</h2>
        </div>
        <div class="stat-card">
            <span>Total Liquidity</span>
            <h2>${{ "{:,.2f}".format(total_money) }}</h2>
        </div>
    </div>

    <div class="section-box" style="border-top: 4px solid #d9534f;">
        <h3 style="color: #d9534f;">Security Alerts</h3>
        <table>
            <thead>
                <tr>
                    <th>User Account</th>
                    <th>Alert Type</th>
                    <th>Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% set ns = namespace(found=false) %}
                
                {% for name, info in all_users.items() %}
                    {% for txn in info.transactions %}
                        {% if txn.amount >= 5000 %}
                            {% set ns.found = true %}
                            <tr>
                                <td><strong>{{ name }}</strong></td>
                                <td class="alert-text">High Value Transaction</td>
                                <td>${{ txn.amount }}</td>
                                <td class="alert-text">Review Needed</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}

                {% if not ns.found %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: #999;">No high-value alerts found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <div class="section-box" style="border-top: 4px solid #0275d8;">
        <h3 style="color: #0275d8;">Quarterly Report</h3>
        <div class="report-text">
            <p><strong>TO:</strong> Board of Directors</p>
            <p><strong>DATE:</strong> Today</p>
            <hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">
            <p>
                The bank currently serves <strong>{{ total_users }}</strong> active users.<br>
                The total liquidity pool stands at <strong>${{ "{:,.2f}".format(total_money) }}</strong>.
            </p>
            <p>
                The average balance per user is <strong>${{ "{:,.2f}".format(avg_balance) }}</strong>.<br>
                Overall financial health is stable.
            </p>
        </div>
    </div>

    <div class="section-box" style="border: 2px solid {{ compliance_color }};">
        <h3 style="color: {{ compliance_color }}; border: none; margin-bottom: 0;">Compliance Status</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
            <p style="margin: 0; color: #555;"><strong>Rule:</strong> Reserves must exceed $50,000</p>
            <span class="compliance-tag" style="background: {{ compliance_color }};">
                {{ compliance_status }}
            </span>
        </div>
    </div>

    <div class="section-box">
        <h3>User Database</h3>
        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Current Balance</th>
                </tr>
            </thead>
            <tbody>
                {% for name, info in all_users.items() %}
                    {% if name != 'admin' %}
                    <tr>
                        <td>{{ name }}</td>
                        <td>{{ info.email }}</td>
                        <td>${{ "{:,.2f}".format(info.balance) }}</td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}