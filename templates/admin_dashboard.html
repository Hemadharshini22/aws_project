{% extends 'base.html' %}

{% block content %}
<style>
    /* Clean, Simple CSS for alignment */
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; color: #333; }
    .container { max-width: 900px; margin: 30px auto; background: white; padding: 30px; border: 1px solid #ddd; }
    
    /* Headers */
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
    h1 { margin: 0; font-size: 24px; }
    h3 { margin-top: 0; color: #444; border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 18px; }

    /* Buttons */
    .logout-btn { background: #d9534f; color: white; text-decoration: none; padding: 8px 15px; border-radius: 4px; font-size: 14px; }
    
    /* Boxes/Sections */
    .section-box { border: 1px solid #ddd; padding: 20px; margin-bottom: 30px; border-radius: 4px; background: #fff; }
    
    /* Tables - Perfect Alignment */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th { text-align: left; background-color: #f9f9f9; padding: 12px; border-bottom: 2px solid #ddd; font-size: 14px; }
    td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
    
    /* Stats Row */
    .stats-row { display: flex; gap: 20px; margin-bottom: 30px; }
    .stat-card { flex: 1; border: 1px solid #ccc; padding: 15px; background: #fdfdfd; text-align: center; }
    .stat-card h2 { margin: 10px 0 0; font-size: 28px; color: #333; }
    
    /* Status Labels */
    .alert-text { color: red; font-weight: bold; }
    .report-text { font-family: 'Courier New', monospace; line-height: 1.5; background: #f9f9f9; padding: 15px; border: 1px solid #eee; }
</style>

<div class="container">

    <div class="header">
        <h1>Admin Dashboard</h1>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <span style="color: #666; font-size: 12px; text-transform: uppercase; font-weight: bold;">Total Users</span>
            <h2>{{ total_users }}</h2>
        </div>
        <div class="stat-card">
            <span style="color: #666; font-size: 12px; text-transform: uppercase; font-weight: bold;">Total Money</span>
            <h2>${{ total_money }}</h2>
        </div>
    </div>

    <div class="section-box" style="border-top: 4px solid #d9534f;">
        <h3 style="color: #d9534f;"> Security Alerts</h3>
        <table>
            <tr>
                <th>User Account</th>
                <th>Alert Type</th>
                <th>Amount</th>
                <th>Status</th>
            </tr>
            {% for name, info in all_users.items() %}
                {% for txn in info.transactions %}
                    {% if txn.amount >= 5000 %}
                    <tr>
                        <td><strong>{{ name }}</strong></td>
                        <td class="alert-text">High Value</td>
                        <td>${{ txn.amount }}</td>
                        <td class="alert-text">Review Needed</td>
                    </tr>
                    {% endif %}
                {% endfor %}
            {% endfor %}

            {% for name, info in all_users.items() %}
                {% if info.transactions|length > 5 %}
                <tr>
                    <td><strong>{{ name }}</strong></td>
                    <td class="alert-text">High Frequency</td>
                    <td>{{ info.transactions|length }} Txns</td>
                    <td class="alert-text">Review Needed</td>
                </tr>
                {% endif %}
            {% endfor %}
        </table>
    </div>

    <div class="section-box" style="border-top: 4px solid #0275d8;">
        <h3 style="color: #0275d8;"> Quarterly Report</h3>
        <div class="report-text">
            <p><strong>TO:</strong> Board of Directors</p>
            <p><strong>DATE:</strong> Today</p>
            <hr style="border: 0; border-top: 1px solid #ccc;">
            <p>
                The bank currently has <strong>{{ total_users }}</strong> active users. <br>
                The total liquidity pool is <strong>${{ total_money }}</strong>.
            </p>
            <p>
                Average balance per user is <strong>${{ avg_balance|round(2) }}</strong>. <br>
                Financial health is stable.
            </p>
        </div>
    </div>

    <div class="section-box" style="border: 2px solid {{ compliance_color }};">
        <h3 style="color: {{ compliance_color }}; border: none; margin-bottom: 0;"> Compliance Status</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <p style="margin: 0;">Rule: Reserves must be > $50,000</p>
            <span style="background: {{ compliance_color }}; color: white; padding: 5px 15px; font-weight: bold; border-radius: 4px;">
                {{ compliance_status }}
            </span>
        </div>
    </div>

    <div class="section-box">
        <h3>User Database</h3>
        <table>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Balance</th>
            </tr>
            {% for name, info in all_users.items() %}
                {% if name != 'admin' %}
                <tr>
                    <td>{{ name }}</td>
                    <td>{{ info.email }}</td>
                    <td>${{ info.balance }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </table>
    </div>

</div>
{% endblock %}